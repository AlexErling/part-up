box: danieldent/meteor
build:
  steps:
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"
    - script:
        name: echo meteor information
        code: |
          echo "meteor version $(meteor -v) running"
    - script:
        name: build application
        code: |
          cd app
          meteor build /tmp
    - script:
        name: run all tests
        code: |
          meteor --test --release velocity:METEOR@1.1.0.2_3 
  after-steps:
    - kobim/slack-post:
        url: $SLACK_URL
        channel: notifications
deploy:
  steps:
    - script:
        name: install modulus-cli
        code: |
          npm install modulus -g
    - script:
        name: deploy to given environment
        code: |
          ./devops deploy ${WERCKER_DEPLOYTARGET_NAME}
        cwd: devops
  after-steps:
    - kobim/slack-post:
        url: $SLACK_URL
        channel: notifications
