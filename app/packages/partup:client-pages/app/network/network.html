<template name="app_network">

    <article class="pu-page pu-page-tinted pu-page-network">
        {{# if subscriptionsReady }}
            <header class="pu-sub-pageheader pu-sub-pageheader-layered {{# if shrinkHeader }}pu-sub-pageheader-layered-shrinked{{/ if }}">
                <!-- profile -->
                <section class="pu-profile">
                    <div class="pu-wrap pu-wrap-columnlayout">
                        <div class="pu-info {{# if networkClosedForUser}} pu-info-minimal{{/ if}}">
                            <figure class="pu-avatar pu-avatar-extralarge pu-avatar-square" style="{{#with network.image }}background-image:url('{{ partupImageUrl id=. store='360x360'}}');{{/with }}">
                            </figure>
                            <div>
                                <h3>{{network.name}}
                                </h3>
                                <p data-expander-parent>
                                    {{network.description}}
                                    {{#if textHasOverflown}}
                                        <a class="pu-readmore" href="#" data-expand data-expanded-key="pages-app-network-collapse" data-collapsed-key="pages-app-network-expand">{{_ 'pages-app-network-expand'}}</a>
                                    {{/if}}
                                </p>
                                <ul class="pu-list pu-list-horizontal">
                                    {{# with network.location }}
                                        <li><a class="pu-metadata" href="#" data-location>
                                            <i class="fa fa-map-marker"></i>
                                            <span>{{ city }}</span>
                                        </a></li>
                                    {{/ with }}
                                    {{# with network.website }}
                                        <li><a class="pu-metadata" href="{{ . }}" target="_blank">
                                            <i class="fa fa-external-link"></i>
                                            <span>{{ getCleanUrl . }}</span>
                                        </a></li>
                                    {{/ with }}
                                </ul>
                            </div>
                        </div>
                        {{# unless network.isClosedForUpper userId }}
                            <ul class="pu-list pu-list-horizontal pu-list-tags">
                                {{# each network.tags }}
                                    <li>
                                        <a href="#" class="pu-tag">{{.}}</a>
                                    </li>
                                {{/ each }}
                            </ul>
                        {{/ unless }}
                    </div>
                </section>
                <section>
                    <div class="pu-wrap pu-wrap-columnlayout">
                        <!-- tabs -->
                        <nav class="pu-navigation pu-navigation-header pu-navigation-full">
                            <ul class="pu-list pu-list-horizontal">
                                <li>
                                    <a href="{{ pathFor route='network-detail' slug=network.slug }}"
                                        class="pu-button pu-button-nav pu-button-nav-secondary {{ isActiveRoute name='network-detail' class='pu-state-active'}}">
                                        <i class="fa fa-globe"></i>
                                        {{_ 'pages-app-network-tab-button-partups'}}
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ pathFor route='network-uppers' slug=network.slug }}"
                                        class="pu-button pu-button-nav pu-button-nav-secondary {{ isActiveRoute name='network-uppers' class='pu-state-active'}}">
                                        <i class="fa fa-line-chart"></i>
                                        {{_ 'pages-app-network-tab-button-uppers'}}
                                    </a>
                                </li>
                            </ul>
                            <!-- actions -->
                            <ul class="pu-list pu-list-horizontal pu-sub-right">
                                <!-- settings button -->
                                {{# if network.isAdmin userId }}
                                    <li>
                                        <a href="{{pathFor 'network-settings' slug=network.slug}}" data-open-networksettings
                                            class="pu-button pu-button-nav pu-button-nav-secondary pu-button-nav-icon pu-button-spinning">
                                            <i class="fa fa-cog"></i>
                                        </a>
                                    </li>
                                {{/ if}}

                                <!-- join or leave button -->
                                {{# if network.hasMember userId }}
                                    {{# if network.canUpperLeave userId }}
                                        <li class="pu-sub-button">
                                            <a class="pu-button" href="#" data-leave>
                                                {{_ 'pages-app-network-actions-button-leave'}}
                                            </a>
                                        </li>
                                    {{/ if }}
                                {{ else }}
                                    {{# if network.canUpperJoin userId }}
                                        <li class="pu-sub-button">
                                            <a class="pu-button {{# if isInvitePending }}pu-button-disabled{{/ if }}" href="#" data-join>
                                                {{# if isInvitePending }}
                                                        {{_ 'pages-app-network-actions-button-pending'}}
                                                {{ else }}
                                                    {{# if network.isUpperInvited userId }}
                                                        {{_ 'pages-app-network-actions-button-accept'}}
                                                    {{ else }}
                                                        {{_ 'pages-app-network-actions-button-join'}}
                                                    {{/ if }}
                                                {{/ if }}
                                            </a>
                                        </li>
                                    {{/ if}}
                                {{/ if}}

                                <!-- invite button -->
                                {{# if network.canUpperInvite userId }}
                                    <li class="pu-sub-button">
                                        <a class="pu-button pu-button-icon" href="{{ pathFor route='network-invite' slug=network.slug }}">
                                            <i class="fa fa-user-plus"></i>
                                            {{_ 'pages-app-network-actions-button-invite'}}
                                        </a>
                                    </li>
                                {{/ if }}
                            </ul>
                        </nav>
                    </div>
                </section>
            </header>
            <div class="pu-sub-pagecontent">
                <div class="pu-wrap pu-wrap-columnlayout">
                    <section class="pu-composition pu-composition-network">
                        {{# if network.isClosedForUpper userId }}
                            {{> app_network_closed network=network.name}}
                        {{else}}
                            {{> yield region='app_network'}}
                        {{/ if }}
                    </section>
                </div>
            </div>
        {{else}}
            {{> Spinner }}
        {{/ if}}
    </article>

</template>
