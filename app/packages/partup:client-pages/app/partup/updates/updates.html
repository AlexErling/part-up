<template name="app_partup_updates">
    <div class="pu-page">
        <div class="pu-composition pu-composition-partupdetailupdates {{#if newUpdatesCount }}pu-composition-partupdetailupdates-newupdatesavailable{{/if}}">

            <!-- new message popup -->
            {{#if partupIsPopupActive 'new-message' }}
                {{#contentFor "PopupTitle"}}
                    {{_ 'pages-app-partup-updates-newmessage-title'}}
                {{/contentFor}}
                {{#contentFor "PopupContent"}}
                    {{> app_partup_updates_newmessage }}
                {{/contentFor}}
            {{/if}}

            <!-- Header buttons -->
            <header class="pu-pageheader">
                <section>
                    {{#if isLoggedIn }}
                        <a class="pu-button pu-button-icon" href="#" data-newmessage-popup>
                            <i class="fa fa-comment"></i>
                            {{_ 'pages-app-partup-updates-new_message' }}
                        </a>
                    {{/if }}
                </section>
                <aside>{{> PartialDropdownUpdatesActions reactiveVar=filterReactiveVar}}</aside>
            </header>

            {{# unless updatesLoading }}

                <div data-infinitescroll-container>

                    <!-- Reveal new updates -->
                    {{#if newUpdatesCount }}
                        <p class="pu-update pu-sub-revealupdatesbutton">
                            <aside></aside>
                            <section><a href="" data-reveal-new-updates class="pu-button pu-button-bluebar">{{_ 'pages-app-partup-updates-revealupdates' count=newUpdatesCount }}</a></section>
                        </p>
                    {{/if}}

                    <!-- For each update -->
                    {{#each updates }}

                        <!-- If it's another day, show a day-separator -->
                        {{#if anotherDay . }}
                            <section class="pu-sub-separator">
                                {{ partupDatePartupTimeline created_at }}
                                <span class="fa fa-long-arrow-down"></span>
                            </section>
                        {{/if }}

                        <!-- Render the update -->
                        {{> Update LINK=true COMMENTS_EXPANDED=false updateId=_id metadata=metaDataForUpdate }}

                    {{/each }}

                    <!-- No updates available -->
                    {{# if updates }}
                        <section class="pu-update">
                            <aside>
                                &nbsp;
                            </aside>
                            <section>
                                {{_ 'pages-app-partup-updates-no_updates'}}
                            </section>
                        </section>
                    {{/ if }}

                </div>

            {{ else }}

                <!-- Loading state -->
                {{# if updatesLoading }}
                    <section class="pu-update">
                        <aside>

                            <!-- Loader indicator where normally a user avatar would be -->
                            <figure class="pu-avatar pu-avatar-label">
                                <a href="#" rel="author" class="pu-sub-image pu-sub-image-loader">
                                    {{> Loader CENTER=true }}
                                </a>
                            </figure>

                        </aside>
                    </section>
                {{/ if }}

            {{/ unless }}

        </div>
    </div>
</template>
