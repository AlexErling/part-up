<template name="WidgetCommentField">
    <!-- Comments -->
    <footer class="pu-commentfield">
        <!-- View all n comments -->
        {{#if showExpandButton }}
            <!-- data-expand-comments -->
            <p class="pu-sub-view-all-comments-button">
                <!-- Determine the correct pathFor -->
                <a href="
                    {{ #if partupContainsOne update.type 'partups_newuser' }}
                        {{pathFor route='profile' _id=user_id }}
                    {{else}}
                        {{pathFor route='partup-detail-update' _id=update.partup_id update_id=update._id }}
                    {{/if}}
                ">
                    {{_ 'widgetcommentfield-comment-viewall-button' update.comments_count }}
                </a>
            </p>
        {{/if }}

        <!-- Comments list -->
        <ul class="pu-list pu-list-comments">
            {{#each shownComments }}
            <li>
                <p>
                    <span rel="author" data-hovercard="{{creator._id}}">{{ creator.name }}</span>
                    {{ content }}
                </p>
            </li>
            {{/each }}
        </ul>

        <!-- Add comment field -->
        {{#if currentUser }}
            {{#autoForm schema=formSchema id=generateFormId class='pu-state-expanded' }}
                <ul class="pu-list pu-list-fieldwithbutton pu-list-fieldwithbutton-init-inactive {{#if commentPostButtonActive }}pu-list-fieldwithbutton-state-active{{/if }}">
                    <li>{{> afFieldInput name="content" class="pu-input" data="commentfield" placeholder=placeholders.comment}}</li>
                    <li><input type="submit" class="pu-button pu-button-inputheight" value="{{_ 'widgetcommentfield-comment-postbutton'}}"></li>
                </ul>
            {{/autoForm}}
        {{/if}}
    </footer>
</template>