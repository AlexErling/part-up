<template name="WidgetPartupdetailUpdateItem">

    <section class="pu-update">
        <aside>

            <!-- User -->
            <figure class="pu-avatar">
                <a href="#" rel="author" class="pu-sub-image" style="{{#if updateUpper.profile.image}}background-image: url('{{ updateUpper.profile.image.url }}');{{/if}}"></a>
                <span class="pu-sub-label">{{ updateUpper.profile.name }}</span>
            </figure>

            <!-- Time -->
            <p class="pu-sub-time">
                <time datetime="{{ partupDateISO created_at }}">{{ partupDatePartupActivity update.created_at }}</time>
            </p>
        </aside>
        <section>

            <!-- Title & first comment button -->
            <header>
                <h3><a href="#">{{_ titleKey }}</a></h3>
                {{#if commentInputFieldExpanded }}{{ else }}
                    <a class="pu-button pu-button-text" data-expand-comment-field>{{_ 'partupdetail-update-item-comment-button' }}</a>
                {{/if }}
            </header>

            <!-- - - - - - - - - - - TYPES START - - - - - - - - - - -->

            <!-- partups_tags_added -->
            {{#if partupEqualsExactly update.type 'partups_tags_added' }}
                {{#with update.type_data }}
                    <section>
                        <span class="pu-tag">{{ new_tag }}</span>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_tags_removed -->
            {{#if partupEqualsExactly update.type 'partups_tags_removed' }}
                {{#with update.type_data }}
                    <section>
                        <span class="pu-tag">{{ old_tag }}</span>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_tags_changed -->
            {{#if partupEqualsExactly update.type 'partups_tags_changed' }}
                {{#with update.type_data }}
                    <section>
                        <ul class="pu-list pu-list-horizontal pu-list-tags pu-list-arrows">
                            <li><span class="pu-tag">{{ old_tag }}</span></li>
                            <li><span class="pu-tag">{{ new_tag }}</span></li>
                        </ul>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_end_date_changed -->
            {{#if partupEqualsExactly update.type 'partups_end_date_changed' }}
                {{#with update.type_data }}
                    <section>
                        <ul class="pu-list pu-list-horizontal pu-list-tags pu-list-arrows">
                            <li><span class="pu-tag pu-tag-angular">{{ partupDateNormal old_end_date }}</span></li>
                            <li><span class="pu-tag pu-tag-angular">{{ partupDateNormal new_end_date }}</span></li>
                        </ul>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_name_changed -->
            {{#if partupEqualsExactly update.type 'partups_name_changed' }}
                {{#with update.type_data }}
                    <section>
                        <p class="pu-title pu-title-updateitem">{{ new_name }}</p>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_description_changed -->
            {{#if partupEqualsExactly update.type 'partups_description_changed' }}
                {{#with update.type_data }}
                    <section>
                        <p class="pu-paragraph pu-paragraph-large">{{ new_description }}</p>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_image_changed -->
            {{#if partupEqualsExactly update.type 'partups_image_changed' }}
                {{#with update.type_data }}
                    <section>
                        <b>OLD</b>
                        <img src="{{ getImageUrlById old_image }}">
                        <b>NEW</b>
                        <img src="{{ getImageUrlById new_image }}">
                    </section>
                {{/with}}
            {{/if }}

            <!-- - - - - - - - - - - TYPES END - - - - - - - - - - -->

            <!-- Comments -->
            <footer>

                <!-- View all n comments -->
                {{#if showExpandButton }}
                    <p class="pu-sub-view-all-comments-button"><a data-expand-comments>{{_ 'partupdetail-update-item-comment-viewall-button' update.comments.length }}</a></p>
                {{/if }}

                <!-- Comments list -->
                <ul class="pu-list pu-list-comments">
                    {{#each shownComments }}
                    <li>
                        <p>
                            <span rel="author">{{ creator.name }}</span>
                            {{ content }}
                        </p>
                    </li>
                    {{/each }}
                </ul>

                <!-- Add comment field -->
                {{#if currentUser }}
                    <!-- {{#if commentInputFieldExpanded }} -->

                        {{#autoForm schema=formSchema id=generateFormId class=commentInputFieldExpanded }}
                            <ul class="pu-list pu-list-fieldwithbutton pu-list-fieldwithbutton-init-inactive {{#if commentPostButtonActive }}pu-list-fieldwithbutton-state-active{{/if }}">
                                <li>{{> afFieldInput name="content" class="pu-input" data="commentfield" }}</li>
                                <li><input type="submit" class="pu-button pu-button-inputheight" value="{{_ 'partupdetail-update-item-comment-postbutton'}}"></li>
                            </ul>
                        {{/autoForm}}

                    <!-- {{/if}} -->
                {{/if}}
            </footer>
        </section>
    </section>

</template>
