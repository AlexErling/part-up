<template name="WidgetPartupdetailUpdateItem">

    <section class="pu-update">
        <aside>

            <!-- User -->
            <figure class="pu-avatar pu-avatar-label">
                <a href="#" rel="author" class="pu-sub-image" style="{{#if updateUpper.profile.image}}background-image: url('{{ updateUpper.profile.image.url }}');{{/if}}"></a>
                <span class="pu-sub-label">{{ updateUpper.profile.name }}</span>
            </figure>

            <!-- Time -->
            <p class="pu-sub-time">
                <time datetime="{{ partupDateISO update.created_at }}" title="{{ partupDateFull update.created_at }}">{{ partupDatePartupActivity update.created_at }}</time>
            </p>
        </aside>
        <section>

            <!-- Title & first comment button -->
            <header>
                <h3>
                <!-- Determine the correct pathFor -->
                <a href="
                    {{ #if partupContainsOne update.type 'partups_newuser' }}
                        {{pathFor route='profile' _id=user_id }}
                    {{else}}
                        {{pathFor route='partup-detail-update' _id=partupId update_id=update._id }}
                    {{/if}}
                ">
                    {{_ titleKey }}
                </a>
                    
                </h3>
                <!-- {{#if commentInputFieldExpanded }}{{ else }}
                    <a class="pu-button pu-button-text" data-expand-comment-field>{{_ 'partupdetail-update-item-comment-button' }}</a>
                {{/if }} -->
            </header>

            <!-- - - - - - - - - - - TYPES START - - - - - - - - - - -->

            <!-- partups_message_added -->
            {{#if partupEqualsExactly update.type 'partups_message_added' }}
                {{#with update.type_data }}
                    <section>
                        <article class="pu-block">
                            <p class="pu-paragraph">{{ new_value }}</p>
                            {{#each images}}
                                <img class="pu-image" src="{{ partupImageById . }}" alt="">
                            {{/each}}
                        </article>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_tags_added -->
            {{#if partupEqualsExactly update.type 'partups_tags_added' }}
                {{#with update.type_data }}
                    <section>
                        <span class="pu-tag">{{ new_tag }}</span>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_tags_removed -->
            {{#if partupEqualsExactly update.type 'partups_tags_removed' }}
                {{#with update.type_data }}
                    <section>
                        <span class="pu-tag">{{ old_tag }}</span>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_tags_changed -->
            {{#if partupEqualsExactly update.type 'partups_tags_changed' }}
                {{#with update.type_data }}
                    <section>
                        <ul class="pu-list pu-list-horizontal pu-list-tags pu-list-arrows">
                            <li><span class="pu-tag">{{ old_tag }}</span></li>
                            <li><span class="pu-tag">{{ new_tag }}</span></li>
                        </ul>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_end_date_changed -->
            {{#if partupEqualsExactly update.type 'partups_end_date_changed' }}
                {{#with update.type_data }}
                    <section>
                        <ul class="pu-list pu-list-horizontal pu-list-tags pu-list-arrows">
                            <li><span class="pu-tag pu-tag-angular">{{ partupDateNormal old_end_date }}</span></li>
                            <li><span class="pu-tag pu-tag-angular">{{ partupDateNormal new_end_date }}</span></li>
                        </ul>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_name_changed -->
            {{#if partupEqualsExactly update.type 'partups_name_changed' }}
                {{#with update.type_data }}
                    <section>
                        <p class="pu-title pu-title-updateitem">{{ new_name }}</p>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_description_changed -->
            {{#if partupEqualsExactly update.type 'partups_description_changed' }}
                {{#with update.type_data }}
                    <section>
                        <p class="pu-paragraph pu-paragraph-large">{{ new_description }}</p>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_image_changed -->
            {{#if partupEqualsExactly update.type 'partups_image_changed' }}
                {{#with update.type_data }}
                    <section>
                        <!-- <b>OLD</b>
                        <img src="{{ getImageUrlById old_image }}"> -->
                        <!-- <b>NEW</b> -->
                        <img class="pu-image" src="{{ getImageUrlById new_image }}">
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_budget_changed -->
            {{#if partupEqualsExactly update.type 'partups_budget_changed' }}
                {{#with update.type_data }}
                    <section>
                        <ul class="pu-list pu-list-horizontal pu-list-tags pu-list-arrows">
                            <!-- OLD -->
                            {{#if partupEquals old_type 'hours'}}
                                <li><span class="pu-tag pu-tag-angular">{{_ 'partupdetail-update-item-budget-type-hours' old_value }}</span></li>
                            {{else}}
                                <li><span class="pu-tag pu-tag-angular">{{_ 'partupdetail-update-item-budget-type-money' old_value }}</span></li>
                            {{/if}}

                            <!-- NEW -->
                            {{#if partupEquals new_type 'hours'}}
                                <li><span class="pu-tag pu-tag-angular">{{_ 'partupdetail-update-item-budget-type-hours' new_value }}</span></li>
                            {{else}}
                                <li><span class="pu-tag pu-tag-angular">{{_ 'partupdetail-update-item-budget-type-money' new_value }}</span></li>
                            {{/if}}
                        </ul>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_location_changed -->
            {{#if partupEqualsExactly update.type 'partups_location_changed' }}
                {{#with update.type_data }}
                    <section>
                        <ul class="pu-list pu-list-horizontal pu-list-tags pu-list-arrows">
                            <li><span class="pu-tag pu-tag-angular">{{ old_location.city }}</span></li>
                            <li><span class="pu-tag pu-tag-angular">{{ new_location.city }}</span></li>
                        </ul>
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_activities_added -->
            {{#if partupEqualsExactly update.type 'partups_activities_added' }}
                {{#with update.type_data }}
                    <section>
                        {{> WidgetActivity activity=activityData CONTRIBUTIONS=isDetail EXPANDED=isDetail }}
                    </section>
                {{/with}}
            {{/if }}

            <!-- partups_activities_changed -->
            {{#if partupEqualsExactly update.type 'partups_activities_changed' }}
                {{#with update.type_data }}
                    <section>
                        {{> WidgetActivity activity=activityData CONTRIBUTIONS=isDetail EXPANDED=isDetail }}
                    </section>
                {{/with}}
            {{/if }}


            <!-- - - - - - - - - - - TYPES END - - - - - - - - - - -->

            <!-- Comments -->
            {{> WidgetCommentField update=update expandedComments=expandedComments}}
        </section>
    </section>

</template>
