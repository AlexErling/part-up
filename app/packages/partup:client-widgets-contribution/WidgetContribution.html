<template name="WidgetContribution">
    {{# if showForm }}
        <div class="pu-contribution pu-contribution-form">
            <figure class="pu-avatar pu-avatar-small" style="background-image: url({{ partupImageById currentUser.profile.image }})"></figure>

            {{# autoForm schema=formSchema id=generateFormId class='pu-form' doc=contribution validation='submitThenKeyup' }}
                <div class="pu-formfield pu-formfield-double pu-contribution-fields">
                    <label class="pu-formfield-left">
                        <span class="pu-label">{{_ 'contribution-form-hours-label' }}</span>
                        <div class="pu-sub-validations {{# if afFieldIsInvalid name='hours' }}pu-state-invalid{{/ if }}">
                            <span class="pu-sub-input">{{> afFieldInput name='hours' placeholder=placeholders.hours class='pu-input pu-input-accent' }}</span>
                            <span class="pu-sub-error">{{ afFieldMessage name='hours' }}</span>
                        </div>
                    </label>

                    <label class="pu-formfield-right">
                        <span class="pu-label">{{_ 'contribution-form-rate-label' }}</span>
                        <div class="pu-sub-validations {{# if afFieldIsInvalid name='rate' }}pu-state-invalid{{/ if }}">
                            <span class="pu-sub-input">{{> afFieldInput name='rate' placeholder=placeholders.rate class='pu-input pu-input-accent' }}</span>
                            <span class="pu-sub-error">{{ afFieldMessage name='rate' }}</span>
                        </div>
                    </label>
                </div>

                <div class="pu-formfield">
                    <div class="pu-formfield-left">
                        <button type="submit" class="pu-button">{{_ 'contribution-form-submit' }}</button>
                        <button type="button" class="pu-button pu-button-gray" data-contribution-close>{{_ 'contribution-form-close' }}</button>
                    </div>

                    {{# unless PLACEHOLDER }}
                        <div class="pu-formfield-right">
                            <button type="button" class="pu-button pu-button-text pu-button-text-subtle" data-contribution-remove>{{_ 'contribution-form-remove' }}</button>
                        </div>
                    {{/ unless }}
                </div>

            {{/ autoForm }}
        </div>
    {{ else }}
        {{# if PLACEHOLDER }}
            <div class="pu-contribution pu-contribution-placeholder">
                <figure class="pu-avatar pu-avatar-small pu-avatar-anonymous"></figure>
                <p>{{ currentUser.profile.name }}</p>
            </div>
        {{ else }}
            {{# if contribution.archived }}
                <div class="pu-contribution pu-contribution-removed">
                    <p>{{_ 'contribution-removed' }}</p>
                </div>
            {{ else }}
                {{# if upperContribution }}
                    <div class="pu-contribution pu-contribution-own">
                        <figure class="pu-avatar pu-avatar-small" style="background-image: url({{# with upper }}{{ partupImageById profile.image }}{{/ with }})">
                            <i class="fa fa-pencil"></i>
                        </figure>
                        {{# if addsValue }}
                            <p>
                                {{# if contribution.hours }}{{_ 'contribution-hour' count=contribution.hours }}{{/ if }}
                                {{# if showSplit }} &mdash; {{/ if }}
                                {{# if contribution.rate }}{{ contribution.rate }} {{_ 'contribution-hourly-rate' }}{{/ if }}
                            </p>
                        {{ else }}
                            <p class="pu-contribution-none">{{_ 'contribution-none' }}</p>
                        {{/ if }}
                        <p class="pu-sub-contribution-comments">
                            <a href="{{ pathFor route='partup-detail-update' _id=contribution.partup_id update_id=contribution.update_id }}"><i class="fa fa-comment"></i> {{ commentsCount }}</a>
                        </p>
                        {{> WidgetRatings contribution=contribution ratings=ratings }}
                    </div>
                {{ else }}
                    <div class="pu-contribution">
                        <figure class="pu-avatar pu-avatar-small" style="background-image: url({{# with upper }}{{ partupImageById profile.image }}{{/ with }})"></figure>
                        {{# if addsValue }}
                            <p>
                                {{# if contribution.hours }}{{_ 'contribution-hour' count=contribution.hours }}{{/ if }}
                                {{# if showSplit }} &mdash; {{/ if }}
                                {{# if contribution.rate }}{{ contribution.rate }} {{_ 'contribution-hourly-rate' }}{{/ if }}
                            </p>
                        {{/ if }}
                        <p class="pu-sub-contribution-comments">
                            <a href="{{ pathFor route='partup-detail-update' _id=contribution.partup_id update_id=contribution.update_id }}"><i class="fa fa-comment"></i> {{ commentsCount }}</a>
                        </p>
                        {{> WidgetRatings contribution=contribution ratings=ratings }}
                        {{# if canVerifyContribution }}
                        <div class="pu-sub-acceptbuttons">
                            <a class="pu-button" data-contribution-accept>{{_ 'contribution-accept'}}</a>
                            <a class="pu-button pu-button-text pu-button-text-subtle" data-contribution-reject>{{_ 'contribution-reject'}}</a>
                        </div>
                        {{/ if }}
                    </div>

                {{/ if }}
            {{/ if }}
        {{/ if }}
    {{/ if }}
</template>
