<template name="Partupsettings">

    {{#autoForm schema=startPartupSchema id=FORM_ID doc=fieldsFromPartup class="pu-form" validation="submitThenBlur" }}

        <!-- Name -->
        <label class="pu-formfield">
            <span class="pu-label">
                {{_ 'partupsettings-form-name-label' }}
                <a class="pu-hint">
                    {{#if partupLowerThan nameCharactersLeft Partup.schemas.entities.partup._schema.name.max}}
                        {{_ 'partupsettings-form-name-validation-left' nameCharactersLeft }}
                    {{else}}
                        {{_ 'partupsettings-form-name-validation' Partup.schemas.entities.partup._schema.name.max }}
                    {{/if}}
                </a>
            </span>

            <div class="pu-sub-validations {{#if afFieldIsInvalid name='name' }}pu-state-invalid{{/if}}">
                <span class="pu-sub-input">{{> afFieldInput name='name' placeholder=formPlaceholders.name class="pu-input" data-max="Partup.schemas.entities.partup._schema.name.max" data-characters-left-var="nameCharactersLeft" }}</span>
                <span class="pu-sub-error">{{ afFieldMessage name='name' }}</span>
            </div>
        </label>

        <!-- Description -->
        <label class="pu-formfield">
            <span class="pu-label">
                {{_ 'partupsettings-form-description-label'}}
                <a class="pu-hint">
                    {{#if partupLowerThan nameCharactersLeft Partup.schemas.entities.partup._schema.description.max}}
                        {{_ 'partupsettings-form-name-validation-left' descriptionCharactersLeft }}
                    {{else}}
                        {{_ 'partupsettings-form-name-validation' Partup.schemas.entities.partup._schema.description.max }}
                    {{/if}}
                </a>
            </span>

            <div class="pu-sub-validations {{#if afFieldIsInvalid name='description' }}pu-state-invalid{{/if}}">
                <span class="pu-sub-input">{{> afFieldInput name='description' placeholder=formPlaceholders.description class="pu-textarea"  rows=3  data-max="Partup.schemas.entities.partup._schema.description.max" data-characters-left-var="descriptionCharactersLeft" }}</span>
                <span class="pu-sub-error">{{ afFieldMessage name='description' }}</span>
            </div>
        </label>

        <!-- Tags -->
        <label class="pu-formfield">
            <span class="pu-label">
                {{_ 'partupsettings-form-tags_input-label'}}
                <a class="pu-hint pu-tooltip">
                    <i class="fa fa-question-circle"></i>
                    <span class="pu-tooltip-wrapper"><p class="pu-paragraph">{{_ 'partupsettings-form-tags_input-tooltip' }}</p></span>
                </a>
            </span>

            <div class="pu-sub-validations {{#if afFieldIsInvalid name='tags_input' }}pu-state-invalid{{/if}}">
                <span class="pu-sub-input">{{> afFieldInput name='tags_input' placeholder=formPlaceholders.tags_input class="pu-input" }}</span>
                <span class="pu-sub-error">{{ afFieldMessage name='tags_input' }}</span>
            </div>
        </label>

        <!-- Budget -->
        <div class="pu-formfield">
            <span class="pu-label">
                {{_ 'partupsettings-form-budget-label'}}
                <a class="pu-hint pu-tooltip">
                    <i class="fa fa-question-circle"></i>
                    <span class="pu-tooltip-wrapper"><p class="pu-paragraph">{{_ 'partupsettings-form-budget-tooltip' }}</p></span>
                </a>
            </span>


            <!-- Budget type selector -->
            <div class="pu-sub-validations {{#if afFieldIsInvalid name='budget_type' }}pu-state-invalid{{/if}}">
                <label class="pu-sub-input"><span class="pu-inputcontainer pu-inputcontainer-select">{{> afFieldInput type='select' firstOption=false name='budget_type' class="pu-input pu-input-select" options=budgetOptions }}</span></label>
                <span class="pu-sub-error">{{ afFieldMessage name='budget_type' }}</span>
            </div>

            <!-- Budget amount: money -->
            {{#if partupEquals budgetType 'money'}}
                <div class="pu-sub-validations {{#if afFieldIsInvalid name='budget_money' }}pu-state-invalid{{/if}}">
                    <label class="pu-sub-input pu-sub-input-half">
                        <span class="pu-inputcontainer pu-inputcontainer-text">
                            <span class="pu-sub-text">
                                {{_ 'partupsettings-form-budget-unit-euro' }}
                            </span>
                            {{> afFieldInput name='budget_money' type='text' placeholder=formPlaceholders.budget_money class="pu-input" focusOnRender=budgetTypeChanged }}
                        </span>
                    </label>
                    <span class="pu-sub-error">{{ afFieldMessage name='budget_money' }}</span>
                </div>
            {{/if }}

            <!-- Budget amount: hours -->
            {{#if partupEquals budgetType 'hours'}}
                <div class="pu-sub-validations {{#if afFieldIsInvalid name='budget_hours' }}pu-state-invalid{{/if}}">
                    <label class="pu-sub-input pu-sub-input-half">
                        <span class="pu-inputcontainer pu-inputcontainer-text">
                            <span class="pu-sub-text">
                                {{_ 'partupsettings-form-budget-unit-hours' }}
                            </span>
                            {{> afFieldInput name='budget_hours' type='text' placeholder=formPlaceholders.budget_hours class="pu-input" focusOnRender=budgetTypeChanged }}
                        </span>
                    </label>
                    <span class="pu-sub-error">{{ afFieldMessage name='budget_hours' }}</span>
                </div>
            {{/if }}

        </div>

        <!-- End date -->
        <label class="pu-formfield">
            <span class="pu-label">
                {{_ 'partupsettings-form-end_date-label'}}
                <a class="pu-hint pu-tooltip">
                    <i class="fa fa-question-circle"></i>
                    <span class="pu-tooltip-wrapper"><p class="pu-paragraph">{{_ 'partupsettings-form-end_date-tooltip' }}</p></span>
                </a>
            </span>

            <div class="pu-sub-validations {{#if afFieldIsInvalid name='end_date' }}pu-state-invalid{{/if}}">
                <div class="pu-inputholder pu-inputholder-lefticon">
                    <span class="pu-sub-input">
                        {{> afFieldInput name='end_date' placeholder=formPlaceholders.end_date class="pu-input pu-datepicker" type="bootstrap-datepicker" datePickerOptions=datepickerOptions }}
                        <a href="#" class="pu-sub-remove fa fa-remove" data-removedate></a>
                    </span>
                    <span class="pu-icon"><i class="fa fa-calendar"></i></span>
                </div>
                <span class="pu-sub-error">{{ afFieldMessage name='end_date' }}</span>
            </div>
        </label>

        <!-- Location -->
        <label class="pu-formfield">
            <span class="pu-label">{{_ 'partupsettings-form-location_input-label'}}</span>
            <div class="pu-sub-validations {{#if afFieldIsInvalid name='location_input' }}pu-state-invalid{{/if}}">
                <span class="pu-sub-input">
                    {{> LocationAutocomplete placeSelectedCallback=placeSelectedCallback clearCallback=clearCallback placeholder=formPlaceholders.location_input location=partup.location }}
                    {{> afFieldInput name='location_input' type='hidden' }}
                </span>
                <span class="pu-sub-error">{{ afFieldMessage name='location_input' }}</span>
            </div>
        </label>

        <!-- network disabled until implemented
        <label class="pu-formfield">
            <span class="pu-label">{{_ 'partupsettings-form-privacy-label' }}</span>
            <div class="pu-inputholder pu-inputholder-righticon">
                {{> afFieldInput type='select' name='privacy_type_input' firstOption=false class="pu-input pu-input-select" options=networkOptions }}
                <span class="pu-icon"><i class="fa fa-caret-down"></i></span>
            </div>
            <a class="pu-hint pu-tooltip">
                <i class="fa fa-question-circle"></i>
                <span class="pu-tooltip-wrapper"><p class="pu-paragraph">{{_ 'partupsettings-form-network-tooltip' }}</p></span>
            </a>
        </label>
        -->

        <!-- Image -->
        <div class="pu-formfield">
            <span class="pu-label">{{_ 'partupsettings-image-label' }}</span>
            {{> afFieldInput name="image" type="hidden" data-image-field="" value=partupImage.currentImageId.get }}
            <input type="file" class="pu-fileinput" id="imageFileInput" data-imageupload>

            {{#with partupImage.focuspoint.get 'x'}}
                {{> afFieldInput name="focuspoint_x_input" value=. type="hidden" }}
            {{/with}}
            {{#with partupImage.focuspoint.get 'y'}}
                {{> afFieldInput name="focuspoint_y_input" value=. type="hidden" }}
            {{/with}}

            {{#if partupImage.uploaded.get }}

                <figure class="pu-imagepreview pu-imagepreview-cover {{#if draggingFocuspoint}}pu-imagepreview-draggingfocuspoint{{/if}}" style="{{#with partupImage.currentImageId.get }}background-image:url('{{ partupImageUrl id=. store='1200x520' }}'){{/with }}" data-focuspoint-view>
                    <div class="pu-sub-loadercontainer {{#if imagepreviewIsLoading }}pu-sub-loadercontainer-active{{/if}}">
                        {{> Loader }}
                    </div>
                    {{> Focuspoint loading=imagepreviewIsLoading imageId=partupImage.currentImageId.get view_elm=focuspointView focuspoint=setFocuspoint unset=unsetFocuspoint }}
                    <div class="pu-sub-buttons">
                        <label for="imageFileInput" class="pu-sub-left pu-button pu-button-secondary">
                            <span>{{_ 'partupsettings-image-button-overwrite'}}</span>
                            {{#if uploadingPicture}}
                                {{> SpinnerInverted}}
                            {{/if}}
                        </label>
                        <button class="pu-sub-right pu-button pu-button-icononly pu-button-tertiery" type="button" data-imageremove>
                            <i class="fa fa-remove"></i>
                        </button>
                    </div>
                </figure>

            {{ else }}

                <div class="pu-upload pu-upload-large">
                    <label for="imageFileInput" class="pu-button pu-button-secondary">
                        <span>{{_ 'partupsettings-image-button'}}</span>
                    </label>
                    <span>{{_ 'partupsettings-image-validation'}}</span>
                </div>

                <p class="pu-textline"><span>{{_ 'partupsettings-suggestion-label'}}</span></p>
                {{#if partupImage.availableSuggestions.get }}
                    {{> Gallery loading=galleryIsLoading pictures=partupImage.availableSuggestions.get current=currentSuggestion setter=suggestionSetter fp_update=onFocuspointUpdate }}
                {{ else }}
                    <figure class="pu-gallery pu-gallery-placeholder">
                        <div class="pu-sub-loadercontainer {{#if partupLoading 'suggesting-images' 'image-uploading' }}pu-sub-loadercontainer-active{{/if}}">
                            {{> Loader }}
                        </div>
                        <figcaption>
                            <p>{{_ 'partupsettings-suggestion-placeholder'}}</p>
                        </figcaption>
                    </figure>
                {{/if }}

            {{/if }}
        </div>

        <!-- Variable footer -->
        {{> yield region="PartupsettingsFooter" }}

    {{/autoForm}}
</template>
