<template name="Comments">
    <!-- Comments -->
    <footer class="pu-commentfield">
        {{# if showComments }}
            <!-- View all n comments -->
            {{#if showExpandButton }}
                <!-- data-expand-comments -->
                <p class="pu-sub-view-all-comments-button">
                    <!-- Determine the correct pathFor -->
                    <a href="
                        {{ #if partupContainsOne update.type 'partups_newuser' }}
                            {{pathFor route='profile' _id=user_id }}
                        {{else}}
                            {{pathFor route='partup-update' _id=update.partup_id update_id=update._id }}
                        {{/if}}
                    ">
                        {{_ 'widgetcommentfield-comment-viewall-button' update.comments_count }}
                    </a>
                </p>
            {{/if }}

            <!-- Comments list -->
            <ul class="pu-list pu-list-comments">
                {{#each shownComments }}
                    <li>
                        <p class="{{# if system }}pu-sub-systemmessage{{/ if}}">
                            <span rel="author" data-usercard="{{creator._id}}">{{ creator.name }}</span>
                            {{# if system }}
                                {{ systemMessage content }}
                            {{else}}
                                {{ content }}
                            {{/ if}}
                            <time title="{{ partupDateFull created_at }}" datetime="{{ created_at.toISOString }}">{{ partupDateComment created_at }}</time>
                        </p>
                    </li>
                {{/each }}
            </ul>
        {{/ if }}

        <!-- Add comment field -->
        {{#if showCommentForm }}
            {{#autoForm schema=formSchema id=generateFormId class='pu-state-expanded' }}
                <ul class="pu-list {{# unless isMotivation }}pu-list-fieldwithbutton pu-list-fieldwithbutton-init-inactive {{#if buttonActive }}pu-list-fieldwithbutton-state-active{{/if }}{{/ unless }}">
                    {{# if isMotivation }}
                        <li>{{> afFieldInput type='textarea' name='content' class='pu-textarea' data='commentfield' placeholder=placeholders.comment maxlength=250 }}</li>
                    {{ else }}
                        <li>{{> afFieldInput name='content' class='pu-input' data='commentfield' placeholder=placeholders.comment maxlength=250 }}</li>
                    {{/ if }}
                    <li>
                        <button type="submit" class="pu-button pu-button-inputheight {{# if submitting }}pu-state-disabled pu-state-loading{{/ if }}">
                            <span>{{_ 'widgetcommentfield-comment-postbutton' }}</span>
                            {{> SpinnerInverted }}
                        </button>
                    </li>
                </ul>
            {{/autoForm}}
        {{/if}}
    </footer>
</template>
