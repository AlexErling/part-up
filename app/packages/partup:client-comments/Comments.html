<template name="Comments">
    <!-- Comments -->
    <footer class="pu-commentfield">
        {{# if showComments }}
        <!-- View all n comments -->
            {{# if partupOneIsTrue FULLVIEW shownComments.length }}
                <p class="pu-sub-view-all-comments-button">
                    {{# unless FULLVIEW }}
                        <a href="
                            {{ #if partupContainsOne update.type 'partups_newuser' }}
                                {{pathFor route='profile' _id=user_id }}
                            {{else}}
                                {{pathFor route='partup-update' slug=partup.slug update_id=update._id }}
                            {{/if}}
                        " class="{{#if newComments upper_data=update.upper_data }}pu-sub-action{{/if}}">
                            {{_ 'widgetcommentfield-comment-totalcomments' update.comments_count }}
                        </a>
                        <span class="pu-sub-seperator"></span>
                    {{/ unless }}
                    <!-- focus button -->
                    <a href="#" data-expand-comments class="pu-sub-action">
                        Reageer
                    </a>
                    {{# if FULLVIEW }}
                        {{# if systemCount }}
                            <span class="pu-sub-seperator"></span>
                            <a href="#" data-toggle-systemmessages>
                                {{# if showSystemMessages }}
                                    Hide system messages
                                {{ else }}
                                    Show system messages
                                {{/ if }}
                            </a>
                        {{/ if }}
                    {{/ if }}
                </p>
            {{/ if }}

            <!-- Comments list -->
            <ul class="pu-list pu-list-comments">
                {{# each shownComments }}
                    {{# if isSystemMessage }}
                        <!-- {{# if showSystemMessages}} -->
                        <li class="pu-comment pu-comment-systemmessage">
                            <figure class="pu-sub-line"></figure>
                            <div>
                                <p class="pu-sub-systemmessage">
                                    <span rel="author" data-usercard="{{creator._id}}">{{ creator.name }}</span>
                                    {{{ systemMessage content }}}
                                </p>
                                <time title="{{ partupDateFull created_at }}" datetime="{{ created_at.toISOString }}">{{ partupDateComment created_at }}</time>
                            </div>
                        </li>
                        <!-- {{/if}} -->
                    {{ else }}
                        <li class="pu-comment">
                            <figure data-usercard="{{creator._id}}" class="pu-avatar pu-avatar-small pu-avatar-square" style="{{#with creator.image }}background-image:url('{{ partupImageUrl id=. store='360x360'}}');{{/with }}"></figure>
                            <div>
                                <p>
                                    {{# if isMotivation }}
                                        <span rel="author" data-usercard="{{creator._id}}">{{ creator.name }}</span>'s
                                        {{_ 'widgetcommentfield-comment-motivation-prefix' }}{{{ partupAutolink content }}}
                                    {{else}}
                                        <span rel="author" data-usercard="{{creator._id}}">{{ creator.name }}</span>
                                        {{{ partupAutolink content }}}
                                    {{/ if}}
                                </p>
                                <time title="{{ partupDateFull created_at }}" datetime="{{ created_at.toISOString }}">{{ partupDateComment created_at }}</time>
                            </div>
                        </li>
                    {{/ if }}
                {{/ each }}
            </ul>
        {{/ if }}

        <!-- Add comment field -->
        {{#autoForm schema=formSchema id=generateFormId class='pu-state-expanded' }}
            <ul class="pu-list
                {{# unless showCommentBox }}
                    pu-state-hidden
                {{/ unless }}

                {{# unless isMotivation }} pu-list-fieldwithbutton pu-list-fieldwithbutton-init-inactive
                    {{# if buttonActive }}pu-list-fieldwithbutton-state-active{{/ if }}
                {{/ unless }}"
            >
                <li class="{{#if messageTooLong}}pu-state-error{{/if}}">
                    {{# if isMotivation }}
                        {{> afFieldInput type='textarea' name='content' class='pu-textarea' data='commentfield' placeholder=placeholders.comment }}
                    {{ else }}
                        {{> afFieldInput type='textarea' name='content' class='pu-textarea pu-textarea-grow' data='commentfield' placeholder=placeholders.comment rows=messageRows }}
                    {{/ if }}
                    {{#if messageTooLong}}
                        <span class="pu-sub-error">{{_ 'widgetcommentfield-comment-maxreached'}}</span>
                    {{/if}}
                </li>
                <li>
                    <button type="submit" class="pu-button pu-button-inputheight {{# if submitting }}pu-state-disabled pu-state-loading{{/ if }}">
                        <span>{{_ 'widgetcommentfield-comment-postbutton' }}</span>
                        {{> Spinner color='inverted' type='small' }}
                    </button>
                </li>
            </ul>
        {{/autoForm}}
    </footer>
</template>
