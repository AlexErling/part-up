<template name="ActivityView">
    <article class="pu-block pu-block-activity {{# if CONTRIBUTIONS }}pu-state-contributions{{/ if }} {{# if contribution }}pu-block-activity-singlecontribution{{/ if }} {{# if expanded }}pu-state-expanded{{/ if }} {{# if CREATE_PARTUP }}pu-block-activity-in-startpartup-modal{{/ if }} {{# if activity.archived }}pu-block-activity-archived{{/ if }}" data-activity-id="{{ activity._id }}">

        <!-- If the activity is a single contribution, show the contribution first -->
        {{# if contribution }}
            <section class="pu-sub-section">
                {{> Contribution contribution=contribution updateContribution=updateContribution READONLY=isReadOnly}}
            </section>
        {{/ if }}

        <!-- Then the title, contributor-avatars and edit button -->
        <section class="pu-sub-section">
            {{# if showEditButton }}
                <a class="pu-sub-editbutton pu-button pu-button-text pu-button-text-subtle" data-activity-edit>{{_ 'activity-button-edit' }}</a>
            {{/ if }}

            {{# if CONTRIBUTIONS }}
                <ul class="pu-avatar-stack">
                    {{# each contributions }}
                        <li class="pu-avatar" style="{{#with upper.profile.image }}background-image: url('{{ partupImageUrl id=. store='80x80' }}');{{/with }}}"></li>
                    {{/ each }}
                </ul>
            {{/ if }}

            <h3 class="pu-sub-title {{# if CONTRIBUTIONS }}{{# unless EXPANDED }}pu-expander{{/ unless }}{{/ if }}" data-activity-expander>
                {{# if UPDATE_LINK }}
                    <a href="{{ pathFor route='partup-update' _id=activity.partup_id update_id=activity.update_id }}">{{ activity.name }}</a>
                    <i class="pu-chevron fa fa-chevron-right"></i>
                {{ else }}
                    {{ activity.name }}
                {{/ if }}

                {{# if showChevron }}
                    <i class="pu-chevron fa {{# if expanded }}fa-chevron-up{{ else }}fa-chevron-down{{/ if }}"></i>
                {{/ if }}
            </h3>

            <!-- If multiple contributions were found, show the activity description and metadata -->
            {{# if contributions }}
                {{# if activity.description }}
                    <p class="pu-sub-description pu-paragraph">{{ activity.description }}</p>
                {{/ if }}

                {{# if showMetaData }}
                    <p class="pu-block-meta">
                        {{# if activity.end_date }}
                            <time class="pu-sub-date" datetime="{{ activity.end_date.toISOString }}" title="{{ partupDateFull activity.end_date }}">{{ partupDateNormal activity.end_date }}</time>
                        {{/if}}

                        {{# if COMMENTS_LINK }}
                            <a class="pu-sub-comments" href="{{ pathFor route='partup-update' _id=activity.partup_id update_id=activity.update_id }}"><i class="fa fa-comment"></i> {{_ 'activity-comment' count=commentsCount }}</a>
                        {{/ if }}
                    </p>
                {{/ if }}
            {{/ if }}
        </section>

        <!-- Show multiple contributiuons if the activity is expandable -->
        {{# if expanded }}
            {{# if contributions.length }}
                <section class="pu-sub-section">
                    {{# each contributions }}
                        {{> Contribution contribution=. updateContribution=updateContribution READONLY=isReadOnly}}
                    {{/ each }}
                </section>
            {{/ if }}

            {{# if showPlaceholderContribution }}
                <section class="pu-sub-section">
                    {{> Contribution activity=activity PLACEHOLDER=true updateContribution=updateContribution }}
                </section>
            {{/ if }}
        {{/ if }}

    </article>
</template>
